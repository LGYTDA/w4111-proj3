{% extends "layout.html" %}

{% block content %}
<div class="container">
    <h1>All Projects</h1>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search projects...">
    </div>

    {% if projects %}
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Status</th>
            <th>Start Date</th>
            <th>Professor</th>
            <th>Applicants</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="projectsTable">
        {% for project in projects %}
        <tr>
            <td>{{ project.project_id }}</td>
            <td>{{ project.title }}</td>
            <td>{{ project.status }}</td>
            <td>{{ project.start_date }}</td>
            <td>{{ project.professor_name }}</td>
            <td>{{ project.applicant_count }}</td>
            <td>
                <a href="/projects/{{ project.project_id }}" class="btn" style="display: inline-block; margin-right: 5px;">View</a>
                {% if session.get('role') == 'student' %}
                {% if project.status.lower() == 'completed' %}
                <a href="#" class="btn-disabled" style="display: inline-block;" onclick="showCompletedMessage()">Apply</a>
                {% else %}
                <a href="/projects/{{ project.project_id }}/apply" class="btn-submit" style="display: inline-block;">Apply</a>
                {% endif %}
                {% endif %}

            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <h3>No projects found</h3>
        <p>There are no projects in the database yet.</p>
    </div>
    {% endif %}


</div>

<!-- Modal for completed project message -->
<div id="completedModal" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 5px;">
        <span style="float: right; cursor: pointer; font-weight: bold;" onclick="closeModal()">&times;</span>
        <h3>Project Completed</h3>
        <p>This project has already been completed and is no longer accepting applicants.</p>
        <button onclick="closeModal()" style="margin-top: 15px; padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">OK</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Simple search functionality
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const searchValue = this.value.toLowerCase();
        const table = document.getElementById('projectsTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            let found = false;
            const cells = rows[i].getElementsByTagName('td');

            for (let j = 0; j < cells.length; j++) {
                const cellText = cells[j].textContent || cells[j].innerText;

                if (cellText.toLowerCase().indexOf(searchValue) > -1) {
                    found = true;
                    break;
                }
            }

            if (found) {
                rows[i].style.display = '';
            } else {
                rows[i].style.display = 'none';
            }
        }
    });

    // Function to show completed project message
    function showCompletedMessage() {
        document.getElementById('completedModal').style.display = 'block';
        return false; // Prevent default action
    }

    // Function to close the modal
    function closeModal() {
        document.getElementById('completedModal').style.display = 'none';
    }

    // Close the modal when clicking outside of it
    window.onclick = function(event) {
        const modal = document.getElementById('completedModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>
{% endblock %}